<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard - CashKing Properties </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }

    header {
      background: #0b3d91;
      color: #fff;
      padding: 1rem 1.5rem;
      font-size: 1.4rem;
      font-weight: bold;
    }

    .container {
      max-width: 1100px;
      margin: 2rem auto;
      background: #fff;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    h2 {
      margin-top: 0;
      font-size: 1.3rem;
    }

    button {
      padding: 0.5rem 1rem;
      margin: 0.3rem 0;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .btn-add {
      background: #0b3d91;
      color: #fff;
    }

    .btn-edit {
      background: #f59e0b;
      color: #fff;
      margin-right: 0.4rem;
    }

    .btn-delete {
      background: #d62828;
      color: white;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    table th, table td {
      border: 1px solid #ccc;
      padding: 0.6rem;
      text-align: left;
    }

    table th {
      background: #eee;
    }

    #addForm {
      margin-top: 1.5rem;
      display: none;
      padding: 1rem;
      background: #f1f1f1;
      border-radius: 8px;
    }

    input, select {
      width: 100%;
      padding: 0.4rem;
      margin-bottom: 0.8rem;
    }
  </style>
</head>
<body>

<header>Admin Dashboard</header>

<div class="container">

  <h2>Properties</h2>
  <button class="btn-add" type="button" onclick="toggleAddForm()">+ Add New Property</button>

  <table id="propertiesTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Price</th>
        <th>Status</th>
        <th>Beds</th>
        <th>Baths</th>
        <th>SqFt</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="addForm">
    <h3>Add Property</h3>

    <input id="title" placeholder="Title" />
    <input id="address" placeholder="Address" />
    <input id="city" placeholder="City" />
    <input id="price" type="number" placeholder="Price" />

    <select id="status">
      <option value="For Sale">For Sale</option>
      <option value="For Rent">For Rent</option>
      <option value="Under Contract">Under Contract</option>
    </select>

    <input id="beds" type="number" placeholder="Beds" />
    <input id="baths" type="number" placeholder="Baths" />
    <input id="sqft" type="number" placeholder="SqFt" />
    <input id="image" placeholder="Image URL" />

    <button class="btn-add" type="button" onclick="saveProperty()">Save Property</button>
  </div>

</div>

<script>
let editingId = null; // <- track if we're editing

async function loadProperties() {
  const res = await fetch("/api/properties");
  const data = await res.json();

  const tbody = document.querySelector("#propertiesTable tbody");
  tbody.innerHTML = "";

  data.forEach((p) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.id}</td>
      <td>${p.title || ""}</td>
      <td>${p.price ? "$" + Number(p.price).toLocaleString() : ""}</td>
      <td>${p.status || ""}</td>
      <td>${p.beds || ""}</td>
      <td>${p.baths || ""}</td>
      <td>${p.sqft || ""}</td>
      <td>
        <button
          class="btn-edit"
          type="button"
          onclick="startEdit(this)"
          data-id="${p.id}"
          data-title="${p.title || ""}"
          data-address="${p.address || ""}"
          data-city="${p.city || ""}"
          data-price="${p.price || ""}"
          data-status="${p.status || "For Sale"}"
          data-beds="${p.beds || ""}"
          data-baths="${p.baths || ""}"
          data-sqft="${p.sqft || ""}"
          data-image="${p.image || ""}"
        >
          Edit
        </button>
        <button class="btn-delete" type="button" onclick="deleteProperty(${p.id})">
          Delete
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function toggleAddForm() {
  const form = document.getElementById("addForm");
  const isVisible = form.style.display === "block";

  if (isVisible) {
    form.style.display = "none";
    clearForm();
  } else {
    form.style.display = "block";
    clearForm(); // ensure it's in "Add" mode
  }
}

function clearForm() {
  document.getElementById("title").value = "";
  document.getElementById("address").value = "";
  document.getElementById("city").value = "";
  document.getElementById("price").value = "";
  document.getElementById("status").value = "For Sale";
  document.getElementById("beds").value = "";
  document.getElementById("baths").value = "";
  document.getElementById("sqft").value = "";
  document.getElementById("image").value = "";

  editingId = null;
  document.querySelector("#addForm h3").textContent = "Add Property";
  document.querySelector("#addForm .btn-add").textContent = "Save Property";
}

// called when you click the Edit button
function startEdit(button) {
  const form = document.getElementById("addForm");
  form.style.display = "block";

  const d = button.dataset;
  editingId = d.id;

  document.querySelector("#addForm h3").textContent = "Edit Property";
  document.querySelector("#addForm .btn-add").textContent = "Update Property";

  document.getElementById("title").value = d.title || "";
  document.getElementById("address").value = d.address || "";
  document.getElementById("city").value = d.city || "";
  document.getElementById("price").value = d.price || "";
  document.getElementById("status").value = d.status || "For Sale";
  document.getElementById("beds").value = d.beds || "";
  document.getElementById("baths").value = d.baths || "";
  document.getElementById("sqft").value = d.sqft || "";
  document.getElementById("image").value = d.image || "";
}

async function saveProperty() {
  const newProp = {
    title: document.getElementById("title").value,
    address: document.getElementById("address").value,
    city: document.getElementById("city").value,
    price: Number(document.getElementById("price").value),
    status: document.getElementById("status").value,
    beds: Number(document.getElementById("beds").value),
    baths: Number(document.getElementById("baths").value),
    sqft: Number(document.getElementById("sqft").value),
    image: document.getElementById("image").value
  };

  const isEditing = !!editingId;
  const url = isEditing ? `/api/properties/${editingId}` : "/api/properties";
  const method = isEditing ? "PUT" : "POST";

  await fetch(url, {
    method,
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(newProp)
  });

  clearForm();
  document.getElementById("addForm").style.display = "none";
  loadProperties();
}

async function deleteProperty(id) {
  await fetch(`/api/properties/${id}`, { method: "DELETE" });
  loadProperties();
}

// Load properties when page opens
loadProperties();
</script>

</body>
</html>
